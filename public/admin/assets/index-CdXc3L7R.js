import{r as t,n as L,d as j,o as k,p as P,q as f,s as B,t as E,j as e,h as R,f as i,v as w,w as n,x as m,y as h,i as V,S as O,z as W,B as z}from"./index----IiH6k.js";import D from"./index-D0ZMJUVB.js";const T=()=>{const o=t.useRef(),{getSetting:p,settings:r}=L(),{t:s}=j(),[l]=k(P("loginParams")),[x,g]=t.useState(""),[S,_]=t.useState(""),[b,C]=t.useState(null),[y,u]=t.useState(!1),d=f(B,{manual:!0,throttleWait:1e3,onSuccess(a){_(a.data.sys_captcha),C(a.data.captcha_img)}}),I=f(E,{manual:!0,debounceWait:500,onBefore(){g(""),u(!0)},onSuccess(a,c){const{status:q,data:v}=a;if(q===0){c=c[0];const F=c.remember?{username:c.username,password:c.password}:{};window.$owl.afterLoginSuccess(F,v.token)}else u(!1),g(a.data.msg),r.login_captcha&&(d.run(),o.current.setFieldsValue({captcha:""}))}}),N=a=>{u(!0),r.login_captcha&&Object.assign(a,{sys_captcha:S}),I.run(a)};return t.useEffect(()=>{r.login_captcha&&d.run()},[r.login_captcha]),t.useEffect(()=>{if(l){const a=JSON.parse(decodeURIComponent(window.atob(l)));o.current.setFieldsValue(a)}o.current.setFieldsValue({remember:!!l})},[l]),e(D,{children:e(R,{className:"p-15px shadow-sm",children:i("div",{className:"w-[320px] p-2",children:[i("div",{className:"flex justify-between",children:[e(w,{src:p("logo"),width:42,preview:!1}),e("div",{className:"text-2xl font-normal",children:p("app_name")})]}),e("div",{className:"h-[32px] flex items-center text-red-500 overflow-hidden",children:x}),i(n,{ref:o,initialValues:{remember:!0},onFinish:N,children:[e(n.Item,{name:"username",rules:[{required:!0,message:s("login.username_required")}],children:e(m,{placeholder:s("login.username"),prefix:e(h,{icon:"ant-design:user-outlined"})})}),e(n.Item,{name:"password",rules:[{required:!0,message:s("login.password_required")}],children:e(m.Password,{placeholder:s("login.password"),prefix:e(h,{icon:"ant-design:key-outlined"})})}),r.login_captcha&&i(V,{children:[e(n.Item,{name:"captcha",rules:[{required:!0,message:s("login.captcha_required")}],children:e(m,{name:"captcha",placeholder:s("login.captcha"),prefix:e(h,{icon:"ant-design:edit-twotone"})})}),e(n.Item,{children:e(O,{spinning:d.loading,children:e(w,{className:"border rounded cursor-pointer",src:b||"",preview:!1,onClick:()=>d.run(),width:100,height:32})})})]}),e(n.Item,{name:"remember",valuePropName:"checked",children:i(W,{children:[" ",s("login.remember_me")," "]})}),e(z,{loading:y,className:"w-full",type:"primary",htmlType:"submit",children:s("login.title")})]})]})})})};export{T as default};
