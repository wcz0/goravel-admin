import{r as t,t as L,d as j,v as k,w as P,h as f,x as B,y as E,j as e,o as R,n as i,z as w,D as n,G as h,H as p,p as V,S as D,J,B as O}from"./index-CS1P21SE.js";import W from"./index-Dky04T3y.js";const H=()=>{const o=t.useRef(),{getSetting:u,settings:r}=L(),{t:s}=j(),[l]=k(P("loginParams")),[x,g]=t.useState(""),[S,_]=t.useState(""),[b,C]=t.useState(null),[y,m]=t.useState(!1),d=f(B,{manual:!0,throttleWait:1e3,onSuccess(a){_(a.data.sys_captcha),C(a.data.captcha_img)}}),I=f(E,{manual:!0,debounceWait:500,onBefore(){g(""),m(!0)},onSuccess(a,c){const{status:v,data:q}=a;if(v===0){c=c[0];const F=c.remember?{username:c.username,password:c.password}:{};window.$owl.afterLoginSuccess(F,q.token)}else m(!1),g(a.data.msg),r.login_captcha&&(d.run(),o.current.setFieldsValue({captcha:""}))}}),N=a=>{m(!0),r.login_captcha&&Object.assign(a,{sys_captcha:S}),I.run(a)};return t.useEffect(()=>{r.login_captcha&&d.run()},[r.login_captcha]),t.useEffect(()=>{if(l){const a=JSON.parse(decodeURIComponent(window.atob(l)));o.current.setFieldsValue(a)}o.current.setFieldsValue({remember:!!l})},[l]),e(W,{children:e(R,{className:"p-15px shadow-sm",children:i("div",{className:"w-[320px] p-2",children:[i("div",{className:"flex justify-between",children:[u("logo")&&e(w,{src:u("logo"),width:42,preview:!1}),e("div",{className:"text-2xl font-normal",children:u("app_name")})]}),e("div",{className:"h-[32px] flex items-center text-red-500 overflow-hidden",children:x}),i(n,{ref:o,initialValues:{remember:!0},onFinish:N,children:[e(n.Item,{name:"username",rules:[{required:!0,message:s("login.username_required")}],children:e(h,{placeholder:s("login.username"),prefix:e(p,{icon:"ant-design:user-outlined"})})}),e(n.Item,{name:"password",rules:[{required:!0,message:s("login.password_required")}],children:e(h.Password,{placeholder:s("login.password"),prefix:e(p,{icon:"ant-design:key-outlined"})})}),r.login_captcha&&i(V,{children:[e(n.Item,{name:"captcha",rules:[{required:!0,message:s("login.captcha_required")}],children:e(h,{name:"captcha",placeholder:s("login.captcha"),prefix:e(p,{icon:"ant-design:edit-twotone"})})}),e(n.Item,{children:e(D,{spinning:d.loading,children:e(w,{className:"border rounded cursor-pointer",src:b||"",preview:!1,onClick:()=>d.run(),width:100,height:32})})})]}),e(n.Item,{name:"remember",valuePropName:"checked",children:i(J,{children:[" ",s("login.remember_me")," "]})}),e(O,{loading:y,className:"w-full",type:"primary",htmlType:"submit",children:s("login.title")})]})]})})})};export{H as default};
